---
layout: post
title: "Linux下的锐捷认证"
date: 2011-9-1 00:24:58
---

由于最近学校改用了锐捷客户端进行认证上网，windows下来认证倒是挺轻松的，可是Linux下就惨了，官方提供的Linux客户端不是一般的坑爹。不过幸好还有强大的开源客户端。试了一些，发现Mentohust相当不错（甚至可以媲美windows下的了）。下面就来说下具体的设置及操作吧。

首先要去下载相应的包进行安装，或者也可以下载源码进行编译安装。项目主页：http://code.google.com/p/mentohust/

安装完毕之后要进行相应的设置，首先运行一下：`sudo mentohsut`，一步一步按照提示输入相应的信息。（这里的信息每个学校都不一样，我只能把我们学校的设置信息贴一下）之后如果能够直接通过认证上网的话就不要往下看了（切记真的不要往下看了，因为可能会出现“使用非法客户端啊，用户被拉入黑名单”的情况。我当初就很荣幸的进入了黑名单，幸好我们学校的黑名单只维持一天，第二天就又可以认证了）。（以后要是想修改相应的设置的话可以修改`/etc/mentohust.conf`，用gedit或者vi都可以的）

```
;用户名，长度不超过64
Username=我的用户名
;密码
Password= 我的密码
;网卡
Nic=eth0
;静态IP用户可以使用非本机IP
IP=0.0.0.0
;掩码，无关紧要
Mask=255.255.255.0
;网关，如果指定了就会监视网关ARP信息
Gateway=0.0.0.0
;DNS服务器，无关紧要
DNS=0.0.0.0
;Ping主机，用于掉线检测，0.0.0.0表示关闭该功能
PingHost=0.0.0.0
;每次发包超时时间（秒）
Timeout=8
;发送Echo包的间隔（秒）
EchoInterval=30
;失败等待（秒）认证失败后等待RestartWait秒或者服务器请求后重启认证
RestartWait=15
;寻找服务器时的组播地址类型 0标准 1锐捷 2将MentoHUST用于赛尔认证
StartMode=1
;DHCP方式 0(不使用) 1(二次认证) 2(认证后) 3(认证前)
DhcpMode=2
;是否后台运行: 0(否) 1(是，关闭输出) 2(是，保留输出) 3(是，输出到文件/tmp/mentohust.log)
DaemonMode=1
;是否显示通知： 0(否) 1~20(是)
ShowNotify=1
;客户端版本号，如果未开启客户端校验但对版本号有要求，可以在此指定，形如3.30
Version=0.00
;认证数据文件，如果需要校验客户端，就需要正确设置
DataFile=
;进行DHCP的脚本
DhcpScript=dhclient
```

如果输入完相应的设置之后还是失败的话（庆幸的是我们学校只要通过上面的设置就可以成功认证了，就要求助你的舍友或者其他windows锐捷用户了。把他们机子上锐捷安装目录下的8021x.exe跟W32N55.dll拷到`/etc/mentohust/`目录下（什么？/etc下没有这个目录？那就mkdir一个嘛）。然后再运行`sudo mentohust`。成功了最好，如果还是失败就在再去拷一个`SuConfig.dat`到`/etc/mentohust/`目录下，再试试sudo mentohust，如果还是失败请继续往下看。

下面的操作你需要一台装着锐捷客户端的windows机子了（找舍友借一下）。去下载一个MentoHUSTTool，在windows下运行抓包（具体步骤就不说了，全自动的，很简单）。得到一个mpf文件，然后把它拷到老地方（linux下的`/etc/mentohust/`目录）。然后运行`sudo mentohust -f/etc/mentohust/***.mpf -w`来把它写入到mentohust的配置文件中，再试试`sudo mentohust`。这样就应该可以了。

Ps. 

1. 客户端默认的是收费的模式（我们学校windows下的锐捷还有免费模式），所以要是没钱的话就不用试了，不可能成功的哦。
2. 要退出锐捷认证，可以运行`sudo mentohust -k`
3. 有个节约流量的小tip，就是充分利用学校的免费资源，也就是ipv6，当然前提是你们学校的ipv6流量是不统计在网络费用之内的。（个人觉得ipv6上谷歌的服务真的基本可以满足日常的需求了，因为本人上个月卡上欠费了，于是……上网只能使用免费的ipv6，但是网络生活还是异常丰富的呢，搜索用Google，看视频用Youtube，听音乐用Google Music，看新闻用Google Reader，邮件用Gmail，聊天用Gtalk，社交用Google+（当然还有Facebook啦）
4. 如果还想节约流量的话，就把系统的源设置成ipv6的（具体怎么做请Google之，我用的是瑞典的一个源，速度还行，可能上交的跟中科大的源速度更快一点，但是貌似教育网的那几个源更新很慢，大半年不更新是常有的事，还有需要注意的是据说有的Linux发行版的安全更新只有ipv4的源才有，所以……要注意一下）
